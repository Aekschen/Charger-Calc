<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#000000" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" />
  <title>Charging Time Calculator v1.3</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 1rem;
      background-color: var(--bg);
      color: var(--text);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    td, th {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: center;
    }
    input, button {
      padding: 0.5rem;
      font-size: 1rem;
    }
    label {
      display: block;
      margin-top: 0.5rem;
    }
    .dark {
      --bg: #121212;
      --text: #fff;
    }
    .light {
      --bg: #fff;
      --text: #000;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .row > * {
      flex: 1;
      min-width: 120px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body class="light">
  <h1>Charging Time Calculator <small>v1.3</small></h1>  <div class="row">
    <label for="start-time">Set Start Time</label>
    <input id="start-time" type="time" />
    <button onclick="clearTime()">Use Current Time</button>
  </div>  <div class="row">
    <label for="battery">Battery %</label>
    <input type="range" id="battery" min="0" max="100" step="1" />
    <input id="batteryInput" type="number" min="0" max="100" step="1" />
  </div>  <div class="row">
    <button style="background: dodgerblue; color: white" onclick="updateTable()">Update</button>
    <button onclick="toggleSettings()">Charging Profile</button>
    <button style="background:black; color:white" onclick="setTheme('dark')">Dark</button>
    <button style="background:white; color:black" onclick="setTheme('light')">Light</button>
  </div>  <div id="settings" class="hidden">
    <h2>Charging Profile (minutes per step)</h2>
    <label>50% <input type="number" id="p50" /></label>
    <label>100% <input type="number" id="p100" /></label>
  </div><canvas id="chart" style="max-width: 100%; margin-top: 2rem;"></canvas>

  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Charge %</th>
        <th>Time Remaining</th>
      </tr>
    </thead>
    <tbody id="table-body"></tbody>
  </table>  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  <script>
    let profile = {};
    const tableBody = document.getElementById("table-body");
    const batterySlider = document.getElementById("battery");
    const batteryInput = document.getElementById("batteryInput");

    batterySlider.addEventListener("input", e => batteryInput.value = e.target.value);
    batteryInput.addEventListener("input", e => batterySlider.value = e.target.value);

    function clearTime() {
      document.getElementById("start-time").value = "";
    }

    function toggleSettings() {
      document.getElementById("settings").classList.toggle("hidden");
    }

    function setTheme(t) {
      document.body.className = t;
    }

    function getStartTime() {
      const t = document.getElementById("start-time").value;
      if (!t) return new Date();
      const now = new Date();
      const [h, m] = t.split(":").map(Number);
      now.setHours(h, m, 0, 0);
      return now;
    }

    function getProfile() {
      const p = {};
      const keys = [50, 100];
      for (const k of keys) {
        const val = parseFloat(document.getElementById("p" + k).value);
        if (!isNaN(val)) p[k] = val * 60; // convert to minutes
      }
      return p;
    }

    function interpolateProfile(profile) {
      const result = {};
      const steps = Object.keys(profile).map(Number).sort((a,b) => a - b);
      for (let i = 0; i < steps.length - 1; i++) {
        const a = steps[i], b = steps[i+1];
        const va = profile[a], vb = profile[b];
        for (let p = a; p <= b; p += 5) {
          const t = (p - a) / (b - a);
          result[p] = va + t * (vb - va);
        }
      }
      return result;
    }

    function updateTable() {
      profile = getProfile();
      const interpolated = interpolateProfile(profile);
      const start = getStartTime();
      const battery = parseInt(batteryInput.value);
      let current = new Date(start);
      let rows = "";
      const labels = [], values = [];
      const steps = Object.keys(interpolated).map(Number).filter(p => p >= battery);

      for (let i = 0; i < steps.length; i++) {
        const p = steps[i];
        const minutes = interpolated[p] - (interpolated[battery] || 0);
        const t = new Date(current.getTime() + minutes * 60000);
        rows += `<tr><td>${t.toTimeString().slice(0,5)}</td><td>${p}%</td><td>${formatMins(minutes)}</td></tr>`;
      }

      tableBody.innerHTML = rows;

      // update chart only with profile-defined points
      const userSteps = Object.keys(profile).map(Number).sort((a,b)=>a-b);
      for (const p of userSteps) {
        labels.push(p + "%");
        values.push(profile[p] / 60); // convert back to hours
      }

      drawChart(labels, values);
    }

    function drawChart(labels, data) {
      if (window.myChart) window.myChart.destroy();
      const ctx = document.getElementById("chart").getContext("2d");
      window.myChart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Charge Time (hours)",
            data,
            fill: false,
            borderColor: "blue",
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              title: { display: true, text: "Hours" }
            }
          }
        }
      });
    }

    function formatMins(m) {
      const h = Math.floor(m / 60);
      const min = Math.round(m % 60);
      return h > 0 ? `${h}h ${min}m` : `${min}m`;
    }
  </script></body>
</html>
